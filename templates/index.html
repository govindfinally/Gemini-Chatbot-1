<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Govind AI - Summarize & Speak</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
    <style>
        body { background: #f3f7fa; padding-top: 50px; }
        .container { max-width: 650px; }
        .card { margin-top: 1.5rem; }
        .spinner-border { margin-top: 1.5rem; }
    </style>
</head>
<body>
<nav class="navbar navbar-dark bg-primary mb-4">
    <div class="container">
        <span class="navbar-brand mb-0 h1">Govind AI</span>
    </div>
</nav>
<div class="container">
    <div class="card shadow">
        <div class="card-body">
            <h4 class="card-title mb-4">Text Summarizer & Speaker</h4>
            <form id="summarizeForm">
                <div class="form-group">
                    <label for="textInput">Enter text to summarize and convert to speech:</label>
                    <textarea id="textInput" name="text" class="form-control" rows="6" required></textarea>
                    <small id="wc" class="form-text text-muted float-right"></small>
                </div>
                <button type="submit" class="btn btn-primary">Summarize & Speak</button>
            </form>
            <div id="loader" style="display:none; text-align:center;">
                <div class="spinner-border text-primary" role="status"></div>
                <p>Processing, please wait...</p>
            </div>
            <div id="alertPlaceholder" style="margin-top: 1rem;"></div>
            <div id="outputSection" style="display:none;">
                <div class="card mt-4">
                    <div class="card-header">Summary</div>
                    <div class="card-body">
                        <p id="summaryText" style="font-weight:bold;"></p>
                        <h6>Keywords:</h6>
                        <p id="keywordsText"></p>
                        <h6>Audio Output:</h6>
                        <audio id="audioPlayer" controls style="width:100%;"></audio>
                        <br>
                        <a id="downloadLink" class="btn btn-success btn-sm mt-3 mb-1" href="#" download>Download Audio</a>
                        <button class="btn btn-outline-secondary btn-sm mt-3 mb-1" onclick="copySummary()">Copy Summary</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer mt-4 text-center text-muted">
        <small>Made by Govind â€¢ &copy; 2025</small>
    </footer>
</div>
<script>
  // Word Count
  document.getElementById('textInput').addEventListener('input', function() {
    let wc = this.value.trim().split(/\s+/).filter(Boolean).length;
    document.getElementById('wc').innerText = `Word count: ${wc}`;
  });

  // Form Submit
  document.getElementById('summarizeForm').addEventListener('submit', async function(e){
    e.preventDefault();

    // Reset UI
    document.getElementById('outputSection').style.display = 'none';
    document.getElementById('alertPlaceholder').innerHTML = '';
    document.getElementById('loader').style.display = 'block';

    const text = document.getElementById('textInput').value;
    try {
      // 1. Summarization
      const summaryResp = await fetch('/summarize', {
        method: "POST",
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({text: text})
      });
      const summaryData = await summaryResp.json();

      if(summaryData.error) throw new Error(summaryData.error);
      // 2. Text-to-speech with summary (not full original text)
      const ttsResp = await fetch('/speak', {
        method: "POST",
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({text: summaryData.summary})
      });
      const ttsData = await ttsResp.json();

      if(ttsData.error) throw new Error(ttsData.error);

      // 3. Display
      document.getElementById('summaryText').innerText = summaryData.summary;
      document.getElementById('keywordsText').innerText = Array.isArray(summaryData.keywords) ? summaryData.keywords.join(', ') : summaryData.keywords;
      document.getElementById('audioPlayer').src = ttsData.audio_url;
      document.getElementById('downloadLink').href = ttsData.download_url;
      document.getElementById('outputSection').style.display = 'block';
    } catch(e) {
      showAlert(e.message || "An unexpected error occurred.");
    } finally {
      document.getElementById('loader').style.display = 'none';
    }
  });

  function showAlert(msg) {
    document.getElementById('alertPlaceholder').innerHTML =
      `<div class="alert alert-danger alert-dismissible fade show" role="alert">
        ${msg}
        <button type="button" class="close" data-dismiss="alert">&times;</button>
       </div>`;
  }

  function copySummary() {
    const summary = document.getElementById('summaryText').innerText;
    navigator.clipboard.writeText(summary).then(
      () => showAlert("Summary copied!", "success"),
      () => showAlert("Copy failed.")
    );
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
